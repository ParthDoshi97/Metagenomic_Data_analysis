<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>q2_feature_table : summarize</title>
    <link rel="stylesheet" href="./q2templateassets/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="./q2templateassets/css/normalize.css"/>
    <link rel="stylesheet" href="./q2templateassets/css/base-template.css"/>
    <script src="./q2templateassets/js/jquery-3.2.0.min.js" charset="utf-8"></script>
    <script src="./q2templateassets/js/bootstrap.min.js" charset="utf-8"></script>
    
<script src="js/vega.min.js"></script>
<script src="js/vega-embed.min.js"></script>
<link rel="stylesheet" type="text/css" href="css/spinkit.css" /> 
  </head>
  <body>
    <div class="container-fluid">
      <div id="q2templatesheader" class="row">
        <div class="col-lg-12">
          <a href="http://qiime2.org/">
            <img src="./q2templateassets/img/qiime2-rect-200.png"
            alt="QIIME 2">
          </a>
        </div>
      </div>
        

  <div class="row">
    <div class="col-lg-12">
      <ul class="nav nav-tabs">
        
          <li class="">
            <a href="index.html">
              Overview
            </a>
          </li>
        
          <li class="active">
            <a href="sample-frequency-detail.html">
              Interactive Sample Detail
            </a>
          </li>
        
          <li class="">
            <a href="feature-frequency-detail.html">
              Feature Detail
            </a>
          </li>
        
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12">
      


<div class="row">

  <div class="col-lg-8">
    <div id="plot">
      <div id="loading" class="spinner">
        <div class="rect1"></div>
        <div class="rect2"></div>
        <div class="rect3"></div>
        <div class="rect4"></div>
        <div class="rect5"></div>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="row">
      <div class="col-lg-12">
        <h3>Plot Controls</h3>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12" id="toolbar"></div>
    </div>

    <div class="row">
      <div class="col-lg-12" id="metadata-category"></div>
    </div>

    <div class="row">
      <div class="col-lg-12" id="sampling-depth-slider"></div>
    </div>

    <div class="row">
      <div class="col-lg-12" id="text-field"></div>
    </div>
  </div>

</div>






<script type="text/javascript">
  function handleErrors(errors, element, msg) {
    console.error(errors);
    msg = msg === undefined ? '' : msg + '<br><br>';
    var helpMsg = '<p class="alert alert-danger"> \
                   There was an error loading and rendering the \
                   visualization.<br><br>' + msg + 'Please \
                   copy-and-paste the following error messages when \
                   reporting this error (please be aware that the content \
                   of your analysis data and/or metadata is included in \
                   these messages):</p>';
    var helpMsgDiv = $('<div></div>');
    helpMsgDiv.append(helpMsg);
    helpMsgDiv.append('<pre><code>' + errors.join('\n\n') + '</code></pre>');
    element.replaceWith(helpMsgDiv);
  }
  window.onerror = function(error) {
    handleErrors([error], $('#loading'));
  };
</script>
<script id="spec" type="application/json">
{"$schema": "https://vega.github.io/schema/vega/v5.json", "autosize": {"contains": "content", "type": "fit-x", "resize": true}, "width": 800, "data": [{"transform": [{"as": "selectedCategory", "expr": "datum.metadata[category]", "type": "formula"}], "name": "table", "values": [{"id": "PRK01002", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/PRK01002/PRK01002.effective.fastq.gz"}, "frequency": 106379.0}, {"id": "SMG01004", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/SMG01004/SMG01004.effective.fastq.gz"}, "frequency": 114416.0}, {"id": "SMG01005", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/SMG01005/SMG01005.effective.fastq.gz"}, "frequency": 117690.0}, {"id": "LPK01006", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/LPK01006/LPK01006.effective.fastq.gz"}, "frequency": 119251.0}, {"id": "RRM01008", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/RRM01008/RRM01008.effective.fastq.gz"}, "frequency": 124957.0}, {"id": "RSM01009", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/RSM01009/RSM01009.effective.fastq.gz"}, "frequency": 110980.0}, {"id": "MSY01012", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/MSY01012/MSY01012.effective.fastq.gz"}, "frequency": 122805.0}, {"id": "YRB01013", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/YRB01013/YRB01013.effective.fastq.gz"}, "frequency": 111422.0}, {"id": "MML01014", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/MML01014/MML01014.effective.fastq.gz"}, "frequency": 115482.0}, {"id": "RRG01015", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/RRG01015/RRG01015.effective.fastq.gz"}, "frequency": 119371.0}, {"id": "AEO01016", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/AEO01016/AEO01016.effective.fastq.gz"}, "frequency": 117080.0}, {"id": "AR001017", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/AR001017/AR001017.effective.fastq.gz"}, "frequency": 125167.0}, {"id": "EMS01018", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/EMS01018/EMS01018.effective.fastq.gz"}, "frequency": 103512.0}, {"id": "APA01019", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/APA01019/APA01019.effective.fastq.gz"}, "frequency": 109536.0}, {"id": "MRK01020", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/MRK01020/MRK01020.effective.fastq.gz"}, "frequency": 110220.0}, {"id": "SSM01021", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/SSM01021/SSM01021.effective.fastq.gz"}, "frequency": 78468.0}, {"id": "TSY01022", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/TSY01022/TSY01022.effective.fastq.gz"}, "frequency": 112879.0}, {"id": "DBM01024", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/DBM01024/DBM01024.effective.fastq.gz"}, "frequency": 109581.0}, {"id": "VHW01025", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/VHW01025/VHW01025.effective.fastq.gz"}, "frequency": 115007.0}, {"id": "SMG01026", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/SMG01026/SMG01026.effective.fastq.gz"}, "frequency": 112706.0}, {"id": "KSS01027", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/KSS01027/KSS01027.effective.fastq.gz"}, "frequency": 123805.0}, {"id": "KRL01028", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/KRL01028/KRL01028.effective.fastq.gz"}, "frequency": 113519.0}, {"id": "PBB01029", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/PBB01029/PBB01029.effective.fastq.gz"}, "frequency": 111947.0}, {"id": "DLD01030", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/DLD01030/DLD01030.effective.fastq.gz"}, "frequency": 112384.0}, {"id": "PDD01031", "metadata": {"absolute-filepath": "/TJPROJ7/GB_MICRO/PJ_AI/amplicon/autoAnalysis/3000/X201SC2210/QIIME2.X201SC22101900-Z01-F019_16SV34_20230608120306/qcCombine/PDD01031/PDD01031.effective.fastq.gz"}, "frequency": 85560.0}]}, {"transform": [{"type": "aggregate", "groupby": ["selectedCategory"]}], "name": "groupedBySelectedCategory", "source": "table"}, {"transform": [{"expr": "datum.frequency >= samplingDepth", "type": "filter"}, {"type": "aggregate", "groupby": ["selectedCategory"]}], "name": "groupedBySelectedCategoryAndRetained", "source": "table"}], "signals": [{"name": "width", "value": "", "bind": {"input": "text"}, "on": [{"events": {"source": "window", "type": "resize"}, "update": "containerSize()[0]"}]}, {"name": "chartHeight", "update": "width / 2.5"}, {"name": "chartOffset", "value": 20}, {"name": "height", "update": "chartHeight + chartOffset"}, {"name": "tooltip", "value": {}, "on": [{"events": "rect:mouseover", "update": "datum"}, {"events": "rect:mouseout", "update": "{}"}]}, {"bind": {"input": "select", "options": ["absolute-filepath"], "element": "#metadata-category"}, "name": "category", "value": "absolute-filepath"}, {"bind": {"input": "range", "element": "#sampling-depth-slider", "max": 125167, "min": 0, "step": 1}, "name": "samplingDepth", "value": 0}], "marks": [{"description": "Interactive rarefaction summary plot", "name": "rarefactionplot", "type": "group", "encode": {"enter": {"x": {"value": 0}, "y": {"signal": "chartOffset"}, "width": {"value": 200}, "height": {"signal": "chartHeight"}}}, "marks": [{"type": "rect", "from": {"data": "groupedBySelectedCategory"}, "encode": {"enter": {"x": {"scale": "xscale", "field": "selectedCategory"}, "width": {"scale": "xscale", "band": 1}, "y": {"scale": "yscale", "field": "count"}, "y2": {"scale": "yscale", "value": 0}}, "update": {"tooltip": {"signal": "{'title': datum.selectedCategory, 'Total Samples': datum.count}"}, "fill": {"value": "#D3D3D3"}, "x": {"scale": "xscale", "field": "selectedCategory"}, "width": {"scale": "xscale", "band": 1}, "y": {"scale": "yscale", "field": "count"}, "y2": {"scale": "yscale", "value": 0}}}}, {"type": "rect", "from": {"data": "groupedBySelectedCategoryAndRetained"}, "encode": {"enter": {"x": {"scale": "xscale", "field": "selectedCategory"}, "width": {"scale": "xscale", "band": 1}, "y": {"scale": "yscale", "field": "count"}, "y2": {"scale": "yscale", "value": 0}}, "update": {"tooltip": {"signal": "{'title': datum.selectedCategory, 'Samples Retained': datum.count}"}, "x": {"scale": "xscale", "field": "selectedCategory"}, "width": {"scale": "xscale", "band": 1}, "y": {"scale": "yscale", "field": "count"}, "y2": {"scale": "yscale", "value": 0}, "fill": {"value": "#1F77B4"}}, "hover": {"fill": {"value": "#60B3F7"}}}}, {"type": "text", "encode": {"enter": {"align": {"value": "center"}, "baseline": {"value": "top"}, "fill": {"value": "#000000"}}, "update": {"x": {"scale": "xscale", "signal": "tooltip.selectedCategory", "band": 0.5}, "y": {"scale": "yscale", "signal": "tooltip.count", "offset": -12}, "text": {"signal": "tooltip.count"}, "fillOpacity": [{"test": "datum === tooltip", "value": 0}, {"value": 1}]}}}], "scales": [{"name": "xscale", "type": "band", "domain": {"data": "groupedBySelectedCategory", "field": "selectedCategory", "sort": true}, "range": "width", "padding": 0.1, "round": true}, {"name": "yscale", "domain": {"fields": [{"data": "groupedBySelectedCategory", "field": "count"}]}, "nice": true, "range": [{"signal": "chartHeight"}, 0]}], "axes": [{"orient": "bottom", "scale": "xscale", "title": {"signal": "category"}, "labelAngle": 90, "labelAlign": "left", "labelBaseline": "middle"}, {"orient": "left", "scale": "yscale", "title": "Number of Samples", "tickMinStep": 1}]}]}
</script>

<script type="text/javascript">
  $(document).ready(function() {
    var spec = JSON.parse(document.getElementById("spec").innerHTML);

    // Try and come up with a good initial estimate of plot dimensions,
    // based on the browser dimensions.
    var opts = {
      width: $("#plot").width(),
      height: $("#plot").width() / 2.5
    };

    vegaEmbed("#plot", spec, opts)
      .then(function(result) {
        result.view.logLevel(vega.Warn);
        // Stash the view object in global namespace for debugging purposes.
        // Check out https://vega.github.io/vega/docs/api/debugging/
        // for more details.
        window.v = result.view;
      })
      .catch(function(error) {
        // From 'js-error-handler.html'
        handleErrors([error], $("#plot"));
      });

    // Clean up the vega-embed toolbar
    var toolbar = $("div .vega-actions").detach();
    toolbar.addClass("btn-group");
    toolbar.children("a").each(function() {
      // NOTE: We're just skipping this bit until we get the plot working with
      // Vega 5
      if(this.innerHTML == "Open in Vega Editor"){
        this.remove()
        return true
      }
      $(this).addClass("btn btn-default");
    });

    toolbar.appendTo("#toolbar");

    var category = $("#metadata-category .vega-bind");
    category
      .children(".vega-bind-name")
      .replaceWith("<label> Metadata Category &nbsp;</label>");
    category.children("select").addClass("form-control");

    var samplingDepthSlider = $("#sampling-depth-slider .vega-bind");
    $(samplingDepthSlider)
      .find("label")
      .remove();
    $(samplingDepthSlider)
      .find("input")
      .attr("id", "range-slider");
    $(samplingDepthSlider)
      .find("input")
      .attr("oninput", "sliderHelperFunction(this.value);");
    $(samplingDepthSlider).prepend(
      "<label> Sampling Depth &nbsp; </label> <br>"
    );
    $(samplingDepthSlider).append(
      '<br> <input id="text-box" class="form-control" type="number" value="0" min="0" oninput="textBoxHelperFunction(this.value);" />'
    );
    $(samplingDepthSlider).append("(zero implies no even sampling)");
    samplingDepthSlider.children(".vega-bind-name").replaceWith("");

    var rotateLabels = $("#rotate-labels .vega-bind");
    rotateLabels
      .children(".vega-bind-name")
      .replaceWith("<label> Rotate Labels &nbsp;</label>");
    rotateLabels.children("checkbox").addClass("form-control");
  });
</script>


<div class="row">
  <div class="col-lg-8">
    <table id="feature-table" class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Sample ID</th>
          <th scope="col">Feature Count</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>
</div>

<script id="table-data" type="application/json">
{"AR001017":125167.0,"RRM01008":124957.0,"KSS01027":123805.0,"MSY01012":122805.0,"RRG01015":119371.0,"LPK01006":119251.0,"SMG01005":117690.0,"AEO01016":117080.0,"MML01014":115482.0,"VHW01025":115007.0,"SMG01004":114416.0,"KRL01028":113519.0,"TSY01022":112879.0,"SMG01026":112706.0,"DLD01030":112384.0,"PBB01029":111947.0,"YRB01013":111422.0,"RSM01009":110980.0,"MRK01020":110220.0,"DBM01024":109581.0,"APA01019":109536.0,"PRK01002":106379.0,"EMS01018":103512.0,"PDD01031":85560.0,"SSM01021":78468.0}
</script>

<script type="text/javascript">
  var totalFrequencies = 2804124;
  var sampleCount = 25;
  var defaultDescription = "Retained " + (totalFrequencies.toLocaleString('en'))
                                       + " (100.00%) features in "
                                       + sampleCount + " (100.00%) samples at the specifed sampling depth.";


  var textField = document.getElementById('text-field');
  var tableBody = document.getElementById("table-body");
  var table = document.getElementById("feature-table");

  // when the viz loads the default description is displayed
  textField.innerHTML = defaultDescription;

  var sampleFrequency = JSON.parse(document.getElementById("table-data").innerHTML);
  // get object keys and store them in an ascending order based on the key value
  // this order is used to create the table rows
  sortedSampleIDs = Object.keys(sampleFrequency).sort(function(a, b) {
    var temp = sampleFrequency[a] - sampleFrequency[b];
    // if two samples have the same number of features then we
    // determine the order using the sample ID alphabetical order
    if (temp == 0){
      return b.localeCompare(a);
    }

  return temp;
  });

  sortedSampleIDs.forEach(function(element) {
    var row = tableBody.insertRow(0);
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    cell1.innerHTML = element;
    cell2.innerHTML = sampleFrequency[element];

  });


  function updateTableandText(val) {
    var retainedSampleCount = 0;

    // start the counter at 1 to ignore the header row
    for (var i = 1; row = table.rows[i]; i++) {

      if (Number(row.cells[1].innerHTML) < val) {
        row.className = "danger";
      } else {
        row.className = "";
        retainedSampleCount += 1;
      }
    }
    if (val == 0){

    textField.innerHTML = defaultDescription;

    }
    else{
      var retainedFeatureCount = retainedSampleCount * val;
      textField.innerHTML = "Retained " + retainedFeatureCount.toLocaleString('en')
                                        + " (" + (retainedFeatureCount/totalFrequencies*100).toFixed(2) + "%) features in "
                                        + retainedSampleCount + " (" + (retainedSampleCount/sampleCount*100).toFixed(2)
                                        +  "%) samples at the specifed sampling depth.";
    }

  }


  function updateSliderVal(val) {
    var slider = document.getElementById("range-slider");
    slider.value = val;
    slider.dispatchEvent(new Event("change"));
    slider.dispatchEvent(new Event("input"));
  }


  function updateBoxVal(val) {
    var num = document.getElementById("text-box");
    num.value = val;
  }


  function sliderHelperFunction(val){
    updateBoxVal(val);
    updateTableandText(val);

  }


  function textBoxHelperFunction(val){
    val = parseInt(val);
    if (val !== val) {
      val = 0;
    }

    // make sure the value in the textbox cannot exceed the max count
    if (val > 125167.0){
      var num = document.getElementById("text-box");
      num.value = 125167.0;
    }
    updateSliderVal(val);
  }
</script>


    </div>
  </div>


    </div>
    <script type="text/javascript">
      if (window.frameElement) {
          document.getElementById('q2templatesheader').remove();
      }
    </script>
    

  </body>
</html>